
# Document Management Strategy & Progress Tracking

## Current State Analysis

### Existing Routes & Pages
1. **Admin Documents** (`/admin/documents`) - Currently shows Documents Library (template listing)
2. **Admin Document List** (`/admin/documents/list`) - Also accessible from admin panel
3. **Document Templates** - Button in admin panel that navigates to `/admin/documents`

### Issues Identified
- ✅ **Confusion**: Two different routes with similar purposes
- ✅ **Inconsistent Naming**: "Document Templates" vs "Documents Library" vs "Document List"
- ✅ **Unclear User Flow**: Not clear which page serves what purpose

## Proposed Solution

### Document Management Architecture

#### 1. **Template Management** (Admin Only)
- **Route**: `/admin/templates/documents`
- **Purpose**: Manage reusable document templates (JSON-based)
- **Features**:
  - Create/Edit/Delete templates
  - Configure template structure
  - Define variables and sections
  - Preview template layout

#### 2. **Generated Documents Library** (Admin & Clients)
- **Route**: `/admin/documents` (Admin) / `/documents` (Clients)
- **Purpose**: View and manage generated PDF documents
- **Features**:
  - List all generated documents
  - Filter by type, date, client
  - Download PDFs
  - Regenerate documents
  - Access control (clients see only their documents)

#### 3. **Document Generation** (Integrated into workflows)
- **Location**: Within Orders, Price Offers, Contracts, etc.
- **Purpose**: Generate documents from templates
- **Features**:
  - Generate from existing data
  - Batch generation
  - Automatic generation on order submission

## Implementation Plan

### Phase 1: Cleanup & Reorganization ✅ IN PROGRESS
- [x] Identify current routes and components
- [ ] Rename routes for clarity
- [ ] Update navigation references
- [ ] Remove duplicate functionality

### Phase 2: Template Management Enhancement
- [ ] Move template management to `/admin/templates/documents`
- [ ] Enhance TemplateEditor component
- [ ] Add template preview functionality
- [ ] Implement template versioning
- [ ] Add template categories (Order, Invoice, Contract, etc.)

### Phase 3: Document Library Optimization
- [ ] Keep `/admin/documents` for generated documents only
- [ ] Add advanced filtering (by type, date, client, status)
- [ ] Implement batch operations (download, delete, regenerate)
- [ ] Add document metadata (creation date, generated by, template used)
- [ ] Implement document access logs

### Phase 4: Integration & Automation
- [ ] Auto-generate documents on order submission
- [ ] Add "Generate Document" button to orders page
- [ ] Implement batch document generation for multiple orders
- [ ] Add email delivery for generated documents
- [ ] Create scheduled document generation jobs

### Phase 5: Client Portal
- [ ] Create `/documents` route for clients
- [ ] Show only client's own documents
- [ ] Add download and view capabilities
- [ ] Implement document request feature
- [ ] Add document notifications

## Updated Route Structure

```
Admin Routes:
├── /admin/templates/documents      → Manage templates (JSON)
├── /admin/documents                → Generated documents library
└── /admin/orders                   → Orders with document generation

Client Routes:
├── /documents                      → Client's document library
└── /orders                         → Orders with document viewing
```

## Navigation Updates

### Admin Panel Cards
1. **Document Templates** → Navigates to `/admin/templates/documents`
2. **Generated Documents** → Navigates to `/admin/documents`

### Order Management Integration
- Add "Generate Document" button to order details
- Auto-generate on order status change
- Batch generation from orders list

## Database Schema Updates

```typescript
// Add to existing schema
documentGeneration: {
  id: uuid
  orderId: uuid (foreign key)
  templateId: uuid (foreign key)
  documentType: enum (order, invoice, contract, price_offer)
  status: enum (pending, generated, failed)
  fileUrl: text
  generatedBy: uuid (user id)
  generatedAt: timestamp
  metadata: json
}

documentAccessLog: {
  id: uuid
  documentId: uuid
  userId: uuid
  action: enum (view, download, regenerate)
  timestamp: timestamp
  ipAddress: text
}
```

## Progress Tracking

### Week 1: Planning & Cleanup
- [x] Analyze current state
- [x] Create strategy document
- [ ] Review with stakeholders
- [ ] Update admin panel navigation

### Week 2: Route Reorganization
- [ ] Implement route changes
- [ ] Update all navigation links
- [ ] Test all document flows
- [ ] Update user documentation

### Week 3: Template Management
- [ ] Move template editor to new route
- [ ] Add template categories
- [ ] Implement template preview
- [ ] Add template versioning

### Week 4: Document Library
- [ ] Enhance filtering
- [ ] Add batch operations
- [ ] Implement access control
- [ ] Add document metadata

### Week 5: Integration
- [ ] Auto-generation on order submit
- [ ] Batch generation
- [ ] Email delivery
- [ ] Testing

### Week 6: Client Portal
- [ ] Client document route
- [ ] Client permissions
- [ ] Document notifications
- [ ] Final testing

## Key Decisions Made

1. **Separate Templates from Documents**: Templates are configurations, documents are outputs
2. **Keep Generated Documents in Library**: Don't delete, maintain history
3. **Role-based Access**: Admins see all, clients see only theirs
4. **Auto-generation**: Trigger on order events for efficiency
5. **Audit Trail**: Track all document access and generation

## Next Steps

1. Review this strategy document
2. Get approval on route structure
3. Begin Phase 1 implementation
4. Schedule weekly progress reviews
5. Update this document as we progress

## Notes & Questions

- **Question**: Should templates be versioned? (Suggested: Yes, to maintain document consistency)
- **Question**: How long should generated documents be kept? (Suggested: Indefinitely with archive option)
- **Question**: Should clients be able to request custom documents? (Suggested: Phase 6 feature)

---

**Last Updated**: 2025-01-19
**Status**: Strategy Approved, Implementation Starting
**Next Review**: Week 2 completion
